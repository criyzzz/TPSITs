package video;

import java.util.ArrayList;
import java.util.Collections;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

class Video {
    String name;
    int duration;

    public Video(String name, int duration) {
        this.name = name;
        this.duration = duration;
    }
}

public class VideoPlayer {

    private ArrayList<Video> playlist;
    private ScheduledExecutorService executor;
    private int currentIndex;

    public VideoPlayer(ArrayList<Video> playlist) {
        this.playlist = playlist;
        this.executor = Executors.newSingleThreadScheduledExecutor();
        this.currentIndex = 0;
    }

    public void startPlayback() {
        Collections.shuffle(playlist); // Mischia la playlist per riprodurre i video in ordine casuale
        scheduleNextVideo();
    }

    private void scheduleNextVideo() {
        if (currentIndex < playlist.size()) {
            Video currentVideo = playlist.get(currentIndex);
            int repetitions = calculateRepetitions(currentVideo);

            for (int i = 0; i < repetitions; i++) {
                System.out.println("Playing video: " + currentVideo.name + " for " + currentVideo.duration + " minutes");

                executor.schedule(() -> {
                    System.out.println("Stopping video: " + currentVideo.name);
                    scheduleNextVideo();
                }, currentVideo.duration * i, TimeUnit.MINUTES);
            }

            currentIndex++;
        } else {
            executor.shutdown();
            System.out.println("All videos played.");
        }
    }

    private int calculateRepetitions(Video video) {
        // Calcola quante volte ripetere il video sulla base della durata totale desiderata
        int totalDuration = video.duration;
        for (int i = currentIndex + 1; i < playlist.size(); i++) {
            totalDuration += playlist.get(i).duration;
        }
        return (int) Math.ceil((double) totalDuration / video.duration);
    }

    public static void main(String[] args) {
        // Esempio di utilizzo
        ArrayList<Video> playlist = new ArrayList<>();
        playlist.add(new Video("Video1", 30));
        playlist.add(new Video("Video2", 10));

        VideoPlayer videoPlayer = new VideoPlayer(playlist);
        videoPlayer.startPlayback();
    }
}
